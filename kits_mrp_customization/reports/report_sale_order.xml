<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="kits_mrp_report_saleorder_document_inherit" inherit_id="sale.report_saleorder_document">
            <xpath expr="//div[@id='informations']" position="inside">
                <t t-set="kcash_value" t-value="abs(sum(doc.order_line.search([('order_id','=',doc.id),('product_id.name','=','K-Cash Reward')]).mapped('price_unit')))"/>
                <div t-if="kcash_value" class="col-auto col-3 mw-100 mb-2">
                    <strong>Applied K-Cash:</strong>
                    <p class="m-0">
                        <t t-esc="kcash_value"/>
                    </p>
                </div>
            </xpath>
            <xpath expr="//tbody//tr" position="attributes">
                <attribute name="t-if">not line.product_id.is_kcash_rewards and not line.product_id.product_tmpl_id.hide_from_order</attribute>
            </xpath>
            <xpath expr="//div['so_total_summary']/div/div/table/t[1]" position="attributes">
                <attribute name="t-value">json.loads(doc.with_context(report=True).tax_totals_json)</attribute>
            </xpath>
            <xpath expr="//div[hasclass('page')]/table[hasclass('table','table-sm','o_main_table')]/thead/tr/th[@name='th_stocked']" position="replace">
                <th name="th_stocked" class="text-left"></th>
            </xpath>
            <xpath expr="//div[hasclass('page')]/table[hasclass('table','table-sm','o_main_table')]/thead/tr/th[@name='th_description']" position="replace">
                <th name="th_image" class="text-left"></th>
                <th name="th_product" class="text-left">Product</th>
                <th name="th_sku" class="text-left">Sku</th>
            </xpath>
            <xpath expr="//div[hasclass('page')]/table[hasclass('table','table-sm','o_main_table')]/tbody/t[@t-foreach='doc.order_line']/tr/t[@t-if='not line.display_type']/td[@name='td_stocked']" position="replace">
                <td name="td_stocked" class="text-center">
                    <t t-if="line.x_studio_stock_item">
                        <div></div>
                    </t>                            
                </td>
            </xpath>
            <xpath expr="//div[hasclass('page')]/table[hasclass('table','table-sm','o_main_table')]/tbody/t[@t-foreach='doc.order_line']/tr/t[@t-if='not line.display_type']/td[@name='td_name']" position="replace">
                <td name="td_image" style="width: 20%;">
                    <t t-if="line.image_256">
                        <img t-att-src="'data:image/png;base64,' + str(line.image_256, 'utf-8')" style="width: 100%;"/>
                    </t>
                    <t t-else="">
                        <!-- <img t-att-src="'/web/static/src/img/placeholder.png'" style="width: 100%;"/> -->
                        <span style="width: 100%;margin-left: 85px;">-</span>
                    </t>

                </td>
                <td name="td_product">
                    <div t-field='line.product_id.name'/>
                    <br/>
                    <t t-set="description" t-value="line._get_name_description()"/>
                    <span t-esc="description"/>
                </td>
                <td name="td_sku"><span t-field="line.product_id.default_code"/></td>
            </xpath>
        </template>
    </data>
</odoo>
