<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <data>
        <template id="inherit_report_delivery_document" inherit_id="stock.report_delivery_document" >
            <xpath expr="//table[@name='stock_move_table']/tbody/tr[1]/td[1]/span" position="replace">
                <span t-field="move.sale_line_id.name" />
            </xpath>
            <xpath expr="//table[@name='stock_move_line_table']/tbody/t[@t-if='o.has_packages']/t[@t-foreach='packages']/t[2]" position="attributes">
                <attribute name="t-value">o.move_line_ids.filtered(lambda l: l.result_package_id == package and l.product_id.product_tmpl_id.hide_from_order == False)</attribute>
            </xpath>
            <xpath expr="//table[@name='stock_move_line_table']/tbody/t[@t-else='']/t[@t-if='has_serial_number']/tr" position="attributes">
                <attribute name="t-foreach">o.move_line_ids.filtered(lambda l: l.product_id.product_tmpl_id.hide_from_order == False)</attribute>
            </xpath>
            <xpath expr="//table[@name='stock_move_line_table']/tbody/t[@t-else='']/t[@t-else='']/t[1]" position="attributes">
                <attribute name="t-value">o.move_line_ids.filtered(lambda l: l.product_id.product_tmpl_id.hide_from_order == False)._get_aggregated_product_quantities()</attribute>
            </xpath>
            <xpath expr="//table[@name='stock_move_line_table']/thead/tr/th[@name='th_sml_product']" position="before">
                <th name="th_sml_image"><strong></strong></th>
            </xpath>
            <xpath expr="/t[1]/t[1]/t[1]/div[1]/table[1]/thead[1]/tr[1]/th[3]" position="replace"/>

            <xpath expr="/t[1]/t[1]/t[1]/div[1]/table[1]/tbody[1]/tr[1]/td[3]" position="replace"/>

            <xpath expr="//table[@name='stock_move_table']/thead/tr/th[@name='th_sm_product']" position="before">
                <th name="th_sm_image"><strong>Image</strong></th>
            </xpath>
            <xpath expr="//table[@name='stock_move_table']/tbody/tr[@t-foreach='lines']/td[1]" position="before">
                <td style="width: 20%;">
                    <t t-if="move.product_id.image_256">
                        <img t-att-src="'data:image/png;base64,' + str(move.product_id.image_256, 'utf-8')" style="width: 100%;"/>
                    </t>
                    <t t-else="">
                        <span style="width: 100%;margin-left: 75px;">-</span>
                    </t>
                </td>
            </xpath>

            <xpath expr="//table[@name='stock_move_table']/thead/tr/th[@name='th_sm_product']" position="after">
                <th name="th_sm_ordered"><strong>Ordered</strong></th>
            </xpath>
            
            <xpath expr="//table[@name='stock_move_table']/tbody/tr[@t-foreach='lines']/td[1]" position="after">
                <td style="text-align: left !important;">
                    <span t-field="move.product_id"/>
                    <p t-if="move.description_picking != move.product_id.name and move.description_picking != move.product_id.display_name">
                        <span t-field="move.description_picking"/>
                    </p>
                </td>
            </xpath>
            
            <xpath expr="//div[hasclass('page')]/div[1]/div[2]" position="after">
                <div t-if="o.sale_id.kcash" class="col-auto" name="div_available_kcash">
                    <strong>Available K-Cash:</strong>
                    <p class="m-0" t-field="o.sale_id.kcash" t-options='{"widget": "monetary", "display_currency": o.sale_id.currency_id}'/>
                    
                </div>
                <t t-set="kcash_value" t-value="abs(sum(o.sale_id.order_line.filtered(lambda x:x.product_template_id.is_kcash_rewards).mapped('price_unit')))"/>
                <div t-if="kcash_value" class="col-auto" name="div_available_kcash">
                    <strong>Applied K-Cash:</strong>
                    <p class="m-0" >
                    <span
                            t-esc="kcash_value"
                            t-options='{"widget": "monetary", "display_currency": o.sale_id.currency_id}'
                        />
                    </p>
                    
                </div>
            </xpath>
        </template>

        <template id="inherit_stock_report_delivery_aggregated_move_lines" inherit_id="stock.stock_report_delivery_aggregated_move_lines" >
            <xpath expr="//tr[@t-foreach='aggregated_lines']/td[1]" position="before">
            <td style="width: 20%;">
                <t t-if="aggregated_lines[line]['product'].image_256">
                    <img t-att-src="'data:image/png;base64,' + str(aggregated_lines[line]['product'].image_256, 'utf-8')" style="width: 100%;"/>
                </t>
                <t t-else="">
                    <!-- <img t-att-src="'/web/static/src/img/placeholder.png'" style="width: 100%;"/> -->
                    <span style="width: 100%;margin-left: 75px;">-</span>
                </t>
            </td>
            </xpath>
        </template>

        <template id="inherit_stock_report_delivery_has_serial_move_line" inherit_id="stock.stock_report_delivery_has_serial_move_line" >
            <xpath expr="//td[1]" position="before">
            <td style="width: 20%;">
                <t t-if="move_line.product_id.image_256">
                    <img t-att-src="'data:image/png;base64,' + str(move_line.product_id.image_256, 'utf-8')" style="width: 100%;"/>
                </t>
                <t t-else="">
                    <!-- <img t-att-src="'/web/static/src/img/placeholder.png'" style="width: 100%;"/> -->
                    <span style="width: 100%;margin-left: 75px;">-</span>
                </t>
            </td>
            </xpath>
        </template>

        <template id="mrp_customization_inherit_report_saleorder_document" inherit_id="sale.report_saleorder_document">
            <xpath expr="//div[@name]" position="replace">
                <div t-if="doc.validity_date" class="col-auto col-3 mw-100 mb-2" name="expiration_date">
                    <strong>Delivery Date:</strong>
                    <p class="m-0" t-field="doc.validity_date"/>
                </div>
            </xpath>
        </template>

        <template id="kits_mrp_customization_inherit_report_picking" inherit_id="stock.report_picking" >
            <xpath expr="//tbody//tr" position="attributes">
                <attribute name="t-if">not ml.product_id.product_tmpl_id.hide_from_order</attribute>
            </xpath>
            <xpath expr="//div[hasclass('page')]/div[3]/div[3]" position="after">
                <div t-if="o.sale_id.kcash" class="col-auto" name="div_available_kcash">
                    <strong>Available K-Cash:</strong>
                    <p class="m-0" t-field="o.sale_id.kcash" t-options='{"widget": "monetary", "display_currency": o.sale_id.currency_id}'/>
                    
                </div>
                <t t-set="kcash_value" t-value="abs(sum(o.sale_id.order_line.filtered(lambda x:x.product_template_id.is_kcash_rewards).mapped('price_unit')))"/>
                <div t-if="kcash_value" class="col-auto" name="div_available_kcash">
                    <strong>Applied K-Cash:</strong>
                    <p class="m-0" >
                    <span
                            t-esc="kcash_value"
                            t-options='{"widget": "monetary", "display_currency": o.sale_id.currency_id}'
                        />
                    </p>
                   
                </div>
            </xpath>
        </template>
    </data>

</odoo>
