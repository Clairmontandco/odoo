<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="kits_mrp_report_invoice_document" inherit_id="account.report_invoice_document">
            <xpath expr="//div[@id='informations']" position="inside">
                <t t-set="kcash_value" t-value="abs(sum(o.invoice_line_ids.search([('move_id','=',o.id),('product_id.name','=','K-Cash Reward')]).mapped('price_unit')))"/>
                <div t-if="kcash_value" class="col-auto col-3 mw-100 mb-2">
                    <strong>Applied K-Cash:</strong>
                    <p class="m-0">
                        <t t-esc="kcash_value"/>
                    </p>
                </div>
            </xpath>
            <xpath expr="//tbody//tr" position="attributes">
                <attribute name="t-if">not line.product_id.is_kcash_rewards</attribute>
            </xpath>
        </template>
        <template id="kits_mrp_document_tax_totals_spt" inherit_id="account.document_tax_totals">
            <xpath expr="//tr[hasclass('o_total')]" position="before">
                <tr t-if="kcash_value" class="border-black kcash_total">
                    <td><strong>K-Cash Reward</strong></td>
                    <td class="text-right">
                        <span t-esc="kcash_value"/>
                    </td>
                </tr>
            </xpath>
        </template>
    </data>
</odoo>